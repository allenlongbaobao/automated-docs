<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Zlib : nodejs API</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="assets_/css/shCore.css">
        <link rel="stylesheet" href="assets_/css/shThemeDefault.css">
        <link rel="stylesheet" href="assets_/css/main.css">
    </head>
    <body data-root-path="">
        <div id="wrapper">
            <div id="content">

<ul id="topnav">
    <li><a href="index.html">Index</a></li>
    <li><a href="#toc">TOC</a></li>
</ul>
<h2>Zlib</h2>

<p>You can access this module with:</p>

<pre><code>var zlib = require('zlib');
</code></pre>

<p>This provides bindings to Gzip/Gunzip, Deflate/Inflate, and
DeflateRaw/InflateRaw classes.  Each class takes the same options, and
is a readable/writable Stream.</p>

<h3>Table of Contents <a href="#toc" name="toc" class="deep-link">#</a></h3>

<ul>
<li><a href="#Examples">Examples</a></li>
<li><a href="#Constants">Constants</a></li>
<li><a href="#zlib.createGzip">zlib.createGzip()</a></li>
<li><a href="#zlib.createGunzip">zlib.createGunzip()</a></li>
<li><a href="#zlib.createDeflate">zlib.createDeflate()</a></li>
<li><a href="#zlib.createInflate">zlib.createInflate()</a></li>
<li><a href="#zlib.createDeflateRaw">zlib.createDeflateRaw()</a></li>
<li><a href="#zlib.createInflateRaw">zlib.createInflateRaw()</a></li>
<li><a href="#zlib.createUnzip">zlib.createUnzip()</a></li>
<li><a href="#zlib.Gzip">zlib.Gzip</a></li>
<li><a href="#zlib.Gunzip">zlib.Gunzip</a></li>
<li><a href="#zlib.Deflate">zlib.Deflate</a></li>
<li><a href="#zlib.Inflate">zlib.Inflate</a></li>
<li><a href="#zlib.DeflateRaw">zlib.DeflateRaw</a></li>
<li><a href="#zlib.InflateRaw">zlib.InflateRaw</a></li>
<li><a href="#zlib.Unzip">zlib.Unzip</a></li>
<li><a href="#zlib.deflate">zlib.deflate()</a></li>
<li><a href="#zlib.deflateRaw">zlib.deflateRaw()</a></li>
<li><a href="#zlib.gzip">zlib.gzip()</a></li>
<li><a href="#zlib.gunzip">zlib.gunzip()</a></li>
<li><a href="#zlib.inflate">zlib.inflate()</a></li>
<li><a href="#zlib.inflateRaw">zlib.inflateRaw()</a></li>
<li><a href="#zlib.unzip">zlib.unzip()</a></li>
<li><a href="#Memory Usage Tuning">Memory Usage Tuning</a></li>
</ul>

<h3>Examples <a href="#Examples" id="Examples" class="deep-link">#</a></h3>

<p>Compressing or decompressing a file can be done by piping an
fs.ReadStream into a zlib stream, then into an fs.WriteStream.</p>

<pre><code>var gzip = zlib.createGzip();
var fs = require('fs');
var inp = fs.createReadStream('input.txt');
var out = fs.createWriteStream('input.txt.gz');

inp.pipe(gzip).pipe(out);
</code></pre>

<p>Compressing or decompressing data in one step can be done by using
the convenience methods.</p>

<pre><code>var input = '.................................';
zlib.deflate(input, function(err, buffer) {
  if (!err) {
    console.log(buffer.toString('base64'));
  }
});

var buffer = new Buffer('eJzT0yMAAGTvBe8=', 'base64');
zlib.unzip(buffer, function(err, buffer) {
  if (!err) {
    console.log(buffer.toString());
  }
});
</code></pre>

<p>To use this module in an HTTP client or server, use the
<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.3">accept-encoding</a>
on requests, and the
<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.11">content-encoding</a>
header on responses.</p>

<p><strong>Note: these examples are drastically simplified to show
the basic concept.</strong>  Zlib encoding can be expensive, and the results
ought to be cached.  See <a href="#memory_Usage_Tuning">Memory Usage Tuning</a>
below for more information on the speed/memory/compression
tradeoffs involved in zlib usage.</p>

<pre><code>// client request example
var zlib = require('zlib');
var http = require('http');
var fs = require('fs');
var request = http.get({ host: 'izs.me',
                         path: '/',
                         port: 80,
                         headers: { 'accept-encoding': 'gzip,deflate' } });
request.on('response', function(response) {
  var output = fs.createWriteStream('izs.me_index.html');

  switch (response.headers['content-encoding']) {
    // or, just use zlib.createUnzip() to handle both cases
    case 'gzip':
      response.pipe(zlib.createGunzip()).pipe(output);
      break;
    case 'deflate':
      response.pipe(zlib.createInflate()).pipe(output);
      break;
    default:
      response.pipe(output);
      break;
  }
});

// server example
// Running a gzip operation on every request is quite expensive.
// It would be much more efficient to cache the compressed buffer.
var zlib = require('zlib');
var http = require('http');
var fs = require('fs');
http.createServer(function(request, response) {
  var raw = fs.createReadStream('index.html');
  var acceptEncoding = request.headers['accept-encoding'];
  if (!acceptEncoding) {
    acceptEncoding = '';
  }

  // Note: this is not a conformant accept-encoding parser.
  // See <a href='http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.3'>http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.3</a>
  if (acceptEncoding.match(/\bdeflate\b/)) {
    response.writeHead(200, { 'content-encoding': 'deflate' });
    raw.pipe(zlib.createDeflate()).pipe(response);
  } else if (acceptEncoding.match(/\bgzip\b/)) {
    response.writeHead(200, { 'content-encoding': 'gzip' });
    raw.pipe(zlib.createGzip()).pipe(response);
  } else {
    response.writeHead(200, {});
    raw.pipe(response);
  }
}).listen(1337);
</code></pre>

<h3>Constants <a href="#Constants" id="Constants" class="deep-link">#</a></h3>

<p>All of the constants defined in zlib.h are also defined on
<code>require('zlib')</code>.  They are described in more detail in the zlib
documentation.  See <a href="http://zlib.net/manual.html#Constants"><a href='http://zlib.net/manual.html#Constants'>http://zlib.net/manual.html#Constants</a></a>
for more details.</p>

<h3>zlib.createGzip([options]) <a href="#zlib.createGzip" id="zlib.createGzip" class="deep-link">#</a></h3>

<p>Returns a new <a href="#zlib.Gzip">Gzip</a> object with an <a href="#options">options</a>.</p>

<h3>zlib.createGunzip([options]) <a href="#zlib.createGunzip" id="zlib.createGunzip" class="deep-link">#</a></h3>

<p>Returns a new <a href="#zlib.Gunzip">Gunzip</a> object with an <a href="#options">options</a>.</p>

<h3>zlib.createDeflate([options]) <a href="#zlib.createDeflate" id="zlib.createDeflate" class="deep-link">#</a></h3>

<p>Returns a new <a href="#zlib.Deflate">Deflate</a> object with an <a href="#options">options</a>.</p>

<h3>zlib.createInflate([options]) <a href="#zlib.createInflate" id="zlib.createInflate" class="deep-link">#</a></h3>

<p>Returns a new <a href="#zlib.Inflate">Inflate</a> object with an <a href="#options">options</a>.</p>

<h3>zlib.createDeflateRaw([options]) <a href="#zlib.createDeflateRaw" id="zlib.createDeflateRaw" class="deep-link">#</a></h3>

<p>Returns a new <a href="#zlib.DeflateRaw">DeflateRaw</a> object with an <a href="#options">options</a>.</p>

<h3>zlib.createInflateRaw([options]) <a href="#zlib.createInflateRaw" id="zlib.createInflateRaw" class="deep-link">#</a></h3>

<p>Returns a new <a href="#zlib.InflateRaw">InflateRaw</a> object with an <a href="#options">options</a>.</p>

<h3>zlib.createUnzip([options]) <a href="#zlib.createUnzip" id="zlib.createUnzip" class="deep-link">#</a></h3>

<p>Returns a new <a href="#zlib.Unzip">Unzip</a> object with an <a href="#options">options</a>.</p>

<h3>zlib.Gzip <a href="#zlib.Gzip" id="zlib.Gzip" class="deep-link">#</a></h3>

<p>Compress data using gzip.</p>

<h3>zlib.Gunzip <a href="#zlib.Gunzip" id="zlib.Gunzip" class="deep-link">#</a></h3>

<p>Decompress a gzip stream.</p>

<h3>zlib.Deflate <a href="#zlib.Deflate" id="zlib.Deflate" class="deep-link">#</a></h3>

<p>Compress data using deflate.</p>

<h3>zlib.Inflate <a href="#zlib.Inflate" id="zlib.Inflate" class="deep-link">#</a></h3>

<p>Decompress a deflate stream.</p>

<h3>zlib.DeflateRaw <a href="#zlib.DeflateRaw" id="zlib.DeflateRaw" class="deep-link">#</a></h3>

<p>Compress data using deflate, and do not append a zlib header.</p>

<h3>zlib.InflateRaw <a href="#zlib.InflateRaw" id="zlib.InflateRaw" class="deep-link">#</a></h3>

<p>Decompress a raw deflate stream.</p>

<h3>zlib.Unzip <a href="#zlib.Unzip" id="zlib.Unzip" class="deep-link">#</a></h3>

<p>Decompress either a Gzip- or Deflate-compressed stream by auto-detecting
the header.</p>

<h2>Convenience Methods</h2>

<p>All of these take a string or buffer as the first argument, and call the
supplied callback with <code>callback(error, result)</code>.  The
compression/decompression engine is created using the default settings
in all convenience methods.  To supply different options, use the
zlib classes directly.</p>

<h3>zlib.deflate(buf, callback) <a href="#zlib.deflate" id="zlib.deflate" class="deep-link">#</a></h3>

<p>Compress a string with Deflate.</p>

<h3>zlib.deflateRaw(buf, callback) <a href="#zlib.deflateRaw" id="zlib.deflateRaw" class="deep-link">#</a></h3>

<p>Compress a string with DeflateRaw.</p>

<h3>zlib.gzip(buf, callback) <a href="#zlib.gzip" id="zlib.gzip" class="deep-link">#</a></h3>

<p>Compress a string with Gzip.</p>

<h3>zlib.gunzip(buf, callback) <a href="#zlib.gunzip" id="zlib.gunzip" class="deep-link">#</a></h3>

<p>Decompress a raw Buffer with Gunzip.</p>

<h3>zlib.inflate(buf, callback) <a href="#zlib.inflate" id="zlib.inflate" class="deep-link">#</a></h3>

<p>Decompress a raw Buffer with Inflate.</p>

<h3>zlib.inflateRaw(buf, callback) <a href="#zlib.inflateRaw" id="zlib.inflateRaw" class="deep-link">#</a></h3>

<p>Decompress a raw Buffer with InflateRaw.</p>

<h3>zlib.unzip(buf, callback) <a href="#zlib.unzip" id="zlib.unzip" class="deep-link">#</a></h3>

<p>Decompress a raw Buffer with Unzip.</p>

<h2>Options</h2>

<p>Each class takes an options object.  All options are optional.  (The
convenience methods use the default settings for all options.)</p>

<p>Note that some options are only
relevant when compressing, and are ignored by the decompression classes.</p>

<ul>
<li>chunkSize (default: 16*1024)</li>
<li>windowBits</li>
<li>level (compression only)</li>
<li>memLevel (compression only)</li>
<li>strategy (compression only)</li>
</ul>

<p>See the description of <code>deflateInit2</code> and <code>inflateInit2</code> at
<a href="http://zlib.net/manual.html#Advanced"><a href='http://zlib.net/manual.html#Advanced'>http://zlib.net/manual.html#Advanced</a></a> for more information on these.</p>

<h3>Memory Usage Tuning <a href="#Memory Usage Tuning" id="Memory Usage Tuning" class="deep-link">#</a></h3>

<p>From <code>zlib/zconf.h</code>, modified to node's usage:</p>

<p>The memory requirements for deflate are (in bytes):</p>

<pre><code>(1 &lt;&lt; (windowBits+2)) +  (1 &lt;&lt; (memLevel+9))
</code></pre>

<p>that is: 128K for windowBits=15  +  128K for memLevel = 8
(default values) plus a few kilobytes for small objects.</p>

<p>For example, if you want to reduce
the default memory requirements from 256K to 128K, set the options to:</p>

<pre><code>{ windowBits: 14, memLevel: 7 }
</code></pre>

<p>Of course this will generally degrade compression (there's no free lunch).</p>

<p>The memory requirements for inflate are (in bytes)</p>

<pre><code>1 &lt;&lt; windowBits
</code></pre>

<p>that is, 32K for windowBits=15 (default value) plus a few kilobytes
for small objects.</p>

<p>This is in addition to a single internal output slab buffer of size
<code>chunkSize</code>, which defaults to 16K.</p>

<p>The speed of zlib compression is affected most dramatically by the
<code>level</code> setting.  A higher level will result in better compression, but
will take longer to complete.  A lower level will result in less
compression, but will be much faster.</p>

<p>In general, greater memory usage options will mean that node has to make
fewer calls to zlib, since it'll be able to process more data in a
single <code>write</code> operation.  So, this is another factor that affects the
speed, at the cost of memory usage.</p>
                <hr />
                <small>Documentation generated by <a href="https://github.com/millermedeiros/mdoc">mdoc</a>.</small>
            </div>
        </div>
        <script src="assets_/js/lib/jquery.js"></script>
        <script src="assets_/js/lib/syntax-highlighter/shCore.js"></script>
        <script src="assets_/js/lib/syntax-highlighter/shAutoloader.js"></script>
        <script src="assets_/js/main.js"></script>
    </body>
</html>

